<link rel="stylesheet" href="/css/home.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<!-- Header -->
<%- include("../partials/user/header") %>
  <%- include("../partials/user/messages") %>

    <main class="homepage">

      <!-- ðŸŒŸ Fullscreen Dynamic Banner -->
      <section class="hero-banner position-relative">
        <div class="hero-slider">

          <% const validBanners=(bannerData || []).filter(banner=> {
            const now = new Date();
            const start = new Date(banner.startDate);
            const end = new Date(banner.endDate);
            return now >= start && now <= end; }); %>

              <% if (validBanners.length> 0) { %>
                <% validBanners.forEach((banner, index)=> { %>
                  <div class="hero-slide <%= index === 0 ? 'active' : '' %>"
                    style="background-image: url('<%= banner.image %>')">
                    <div class="hero-overlay"></div>
                    <div class="hero-content container">
                      <% if (banner.subtitle) { %>
                        <h5>
                          <%= banner.subtitle %>
                        </h5>
                        <% } %>
                          <% if (banner.title) { %>
                            <h1>
                              <%= banner.title %>
                            </h1>
                            <% } %>
                              <% if (banner.description) { %>
                                <p>
                                  <%= banner.description %>
                                </p>
                                <% } %>
                                  <% if (banner.buttonText && banner.buttonLink) { %>
                                    <a href="<%= banner.buttonLink %>" class="shop-btn">
                                      <%= banner.buttonText %>
                                    </a>
                                    <% } %>
                    </div>
                  </div>
                  <% }) %>
                    <% } else { %>
                      <!-- ðŸ–¼ï¸ Fallback banner -->
                      <div class="hero-slide active" style="background-image: url('/img/header-img.jpg')">
                        <div class="hero-overlay"></div>
                        <div class="hero-content container">
                          <h5>Welcome to ElectroHub</h5>
                          <h1>Your One-Stop Electronics Store</h1>
                          <p>Explore the latest gadgets, phones, and accessories at unbeatable prices!</p>
                          <a href="/shop" class="shop-btn">Shop Now</a>
                        </div>
                      </div>
                      <% } %>

        </div>

        <!-- Navigation -->
        <button class="hero-nav prev"><i class="fa-solid fa-chevron-left"></i></button>
        <button class="hero-nav next"><i class="fa-solid fa-chevron-right"></i></button>

        <!-- Dots -->
        <div class="hero-dots"></div>
      </section>


      <!-- ðŸ§© Categories -->
      <section class="categories py-4 bg-light">
        <div class="container d-flex justify-content-center flex-wrap gap-3">
          <div class="cat-box active"><i class="fas fa-mobile-alt fa-2x"></i>
            <p>Phones</p>
          </div>
          <div class="cat-box"><i class="fas fa-laptop fa-2x"></i>
            <p>Computers</p>
          </div>
          <div class="cat-box"><i class="fas fa-clock fa-2x"></i>
            <p>SmartWatch</p>
          </div>
          <div class="cat-box"><i class="fas fa-camera fa-2x"></i>
            <p>Camera</p>
          </div>
          <div class="cat-box"><i class="fas fa-gamepad fa-2x"></i>
            <p>Gaming</p>
          </div>
          <div class="cat-box"><i class="fas fa-headphones fa-2x"></i>
            <p>Headphones</p>
          </div>
        </div>
      </section>

      <!-- ðŸ›ï¸ Product Section -->
      <section class="products py-5 bg-black text-white">
        <div class="container">
          <!-- Tabs -->
          <ul class="nav nav-tabs border-0 mb-4" id="productTabs">
            <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#new">New Arrivals</a></li>
            <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#best">Best Sellers</a></li>
            <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#hot">Hot Sales</a></li>
          </ul>

          <!-- Tab Contents -->
          <div class="tab-content">

            <!-- ðŸ†• New Arrivals -->
            <div id="new" class="tab-pane fade show active">
              <% if (newArrivals && newArrivals.length> 0) { %>
                <div class="product-grid">
                  <% newArrivals.forEach(product=> { %>
                    <div class="product-card">
                      <div class="product-img-wrapper">
                        <img src="<%= product.variantImage %>" alt="<%= product.name %>"
                          onclick="location.href='/ProductDetails?id=<%=product._id%>'">
                        <div class="product-actions">
                          <button class="btn btn-light shadow-sm action-btn"
                            onclick="addToWishlist('<%= product._id %>')">
                            <i class="fa-regular fa-heart"></i>
                          </button>
                          <button class="btn btn-primary shadow-sm action-btn"
                            onclick="addToCart('<%= product._id %>')">
                            <i class="fa-solid fa-cart-plus"></i>
                          </button>
                        </div>
                      </div>
                      <div class="text-center mt-2">
                        <h6 class="fw-semibold text-truncate mb-1">
                          <%= product.name %>
                        </h6>
                        <p class="text-success fw-bold mb-0">â‚¹<%= product.price.toLocaleString() %>
                        </p>
                        <small class="text-warning">â˜…â˜…â˜…â˜…â˜†</small>
                      </div>
                    </div>
                    <% }) %>
                </div>
                <% } else { %>
                  <p class="text-center text-muted">No new arrivals available.</p>
                  <% } %>
            </div>

            <!-- â­ Best Sellers -->
            <div id="best" class="tab-pane fade">
              <div class="product-grid">
                <% for (let i=1; i <=8; i++) { %>
                  <div class="product-card">
                    <div class="product-img-wrapper">
                      <img src="/img/product-<%= i %>.png" alt="Product <%= i %>">
                      <div class="product-actions">
                        <button class="btn btn-light shadow-sm action-btn"><i class="fa-regular fa-heart"></i></button>
                        <button class="btn btn-primary shadow-sm action-btn"><i
                            class="fa-solid fa-cart-plus"></i></button>
                      </div>
                    </div>
                    <div class="text-center mt-2">
                      <h6 class="fw-semibold text-truncate mb-1">Product <%= i %>
                      </h6>
                      <p class="text-success fw-bold mb-0">$99.<%= i %>
                      </p>
                      <small class="text-warning">â˜…â˜…â˜…â˜…â˜…</small>
                    </div>
                  </div>
                  <% } %>
              </div>
            </div>

            <!-- ðŸ”¥ Hot Sales -->
            <div id="hot" class="tab-pane fade">
              <p class="text-center text-muted">Hot deals will appear here soon...</p>
            </div>
          </div>
        </div>
      </section>

      <!-- ðŸšš Features -->
      <section class="features py-4 bg-light">
        <div class="container d-flex justify-content-around text-center flex-wrap">
          <div class="feature-box">
            <div class="icon"><i class="fas fa-shipping-fast"></i></div>
            <h6>Free & Fast Delivery</h6>
            <p class="small">Free delivery for all orders over â‚¹50</p>
          </div>
          <div class="feature-box">
            <div class="icon"><i class="fas fa-headset"></i></div>
            <h6>24/7 Customer Service</h6>
            <p class="small">Friendly 24/7 customer support</p>
          </div>
          <div class="feature-box">
            <div class="icon"><i class="fas fa-undo"></i></div>
            <h6>Money Back Guarantee</h6>
            <p class="small">We return money within 30 days</p>
          </div>
        </div>
      </section>

    </main>

    <!-- Footer -->
    <%- include("../partials/user/footer") %>

      <!-- Banner JS -->
      <script>

        document.addEventListener("DOMContentLoaded", () => {
          const slides = document.querySelectorAll(".hero-slide");
          const dotsContainer = document.querySelector(".hero-dots");
          let currentSlide = 0;
          let slideInterval;

          if (!slides || slides.length === 0) return;

          // Create dots
          slides.forEach((_, i) => {
            const dot = document.createElement("span");
            if (i === 0) dot.classList.add("active");
            dot.addEventListener("click", () => showSlide(i));
            dotsContainer.appendChild(dot);
          });

          const dots = document.querySelectorAll(".hero-dots span");

          function showSlide(index) {
            slides.forEach((slide, i) => slide.classList.toggle("active", i === index));
            dots.forEach((dot, i) => dot.classList.toggle("active", i === index));
            currentSlide = index;
          }

          function nextSlide() {
            showSlide((currentSlide + 1) % slides.length);
          }

          function prevSlide() {
            showSlide((currentSlide - 1 + slides.length) % slides.length);
          }

          document.querySelector(".hero-nav.next").addEventListener("click", nextSlide);
          document.querySelector(".hero-nav.prev").addEventListener("click", prevSlide);

          function autoPlay() {
            clearInterval(slideInterval);
            slideInterval = setInterval(nextSlide, 5000);
          }

          autoPlay();
        });
      </script>