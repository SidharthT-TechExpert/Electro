<link rel="stylesheet" href="/css/home.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<%- include("../partials/user/header") %>
  <%- include("../partials/user/messages") %>

    <main class="profile-page container my-5">
      <div class="row">
        <!-- Sidebar -->
        <%- include("../partials/user/sideBar") %>

          <!-- Main Profile Section -->
          <section class="col-md-9">
            <div class="card shadow-sm p-4 border-0">
              <h5 class="text-danger fw-semibold mb-4">Edit Your Profile</h5>

              <!-- Profile Photo Upload -->
              <div class="text-center mb-4">
                <img id="profilePreview"
                  src="<%= user.profilePhoto ? '/profile-photo/' + user.profilePhoto : '/uploads/img/user.png' %>"
                  alt="Profile Photo" class="rounded-circle border" width="120" height="120" style="object-fit: cover;">

                <% if(user?.profilePhoto) { %>
                  <div class="mt-2 text-center">
                    <button id="deletePhotoBtn" class="btn btn-outline-danger btn-sm">
                      <i class="bi bi-trash"></i> Delete Photo
                    </button>
                  </div>
                  <% } %>

                    <div class="mt-2">
                      <label class="btn btn-outline-dark btn-sm">

                        <i class="fa fa-camera"></i>
                        <%= user?.profilePhoto ? "Change Photo" : "Upload Photo" %>
                          <input name="profilePhoto" id="profilePhotoInput" hidden>
                      </label>
                    </div>
              </div>

              <!-- Name -->
              <div class="mb-3">
                <label class="form-label fw-semibold">Name
                  <a onclick="editName('<%= user.name %>','<%= user._id %>' )" class="text-primary small ms-1">Edit</a>
                </label>
                <input type="text" class="form-control" value="<%= user.name %>" readonly>
              </div>

              <!-- Password Changes -->
              <h6 class="fw-bold mt-4 mb-3">Password Changes</h6>
              <form id="passwordForm" onsubmit="return ChangePassword(this)">
                <% if(user?.password) { %>
                  <div class="mb-3">
                    <input value='<% user?.password %>' type="password" name="cPassword" class="form-control"
                      placeholder="Current Password">
                  </div>
                  <% } %>
                    <div class="mb-3">
                      <input type="password" name="Password" class="form-control" placeholder="New Password">
                    </div>
                    <div class="mb-3">
                      <input type="password" name="confirmPassword" class="form-control"
                        placeholder="Confirm New Password">
                    </div>
                    <div class="d-flex justify-content-end gap-2">
                      <button type="button" onclick="this.form.reset()" class="btn btn-outline-dark">Cancel</button>
                      <button type="submit" class="btn btn-danger fw-semibold">Update Password</button>
                    </div>
              </form>

              <!-- Email & Phone -->
              <div class="row mt-4">
                <div class="col-md-6 mb-3">
                  <label class="form-label fw-semibold">Email
                    <a onclick="editEmail('<%= user.email %>', '<%= user.id %>')"
                      class="text-primary small ms-1">Edit</a>
                  </label>
                  <input type="email" class="form-control" value="<%= user.email %>" readonly>
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label fw-semibold">Phone
                    <a onclick="editPhone('<%= user.phone %>')" class="text-primary small ms-1">Edit</a>
                  </label>
                  <input type="text" class="form-control" value="<%= user.phone %>" readonly>
                </div>
              </div>
            </div>
          </section>
      </div>
      <session>
        <div id="previewBox">

        </div>
      </session>

    </main>


    <%- include("../partials/user/footer") %>

      <style>
        .swal-popup-professional {
          font-family: 'Segoe UI', sans-serif;
          font-size: 16px;
        }

        .swal-title-professional {
          font-weight: 600;
          font-size: 18px;
        }

        .swal-text-professional {
          color: #555;
        }

        .swal-btn-professional {
          background-color: #007bff !important;
          color: #fff !important;
          font-weight: 500;
        }

        .card input[readonly] {
          background: #f8f8f8;
        }

        .btn-danger {
          background: #e63946;
          border: none;
        }

        .btn-danger:hover {
          background: #c92c3d;
        }

        #previewBox {
          position: absolute;
          right: 450px;
          top: 200px;
          background-color: rgb(255, 255, 255);
          width: 250px;
          height: 250px;
          display: none;
          justify-content: center;
          align-items: center;
          overflow: hidden;
          border-radius: 10px;
        }
      </style>

      <!-- Include SweetAlert2 + Cropper.js -->
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
      <script src="/js/main.js"></script>

      <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
      <script src="/js/user/myProfile.js"></script>

      <script>
        const profilePhoto =
          "<%= user && user.profilePhoto ? ('/profile-photo/' + user.profilePhoto) : '/uploads/img/user.png' %>";
      </script>